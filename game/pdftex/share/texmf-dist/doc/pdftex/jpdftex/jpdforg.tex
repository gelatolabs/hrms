%
% A sample of Japanese pdfLaTeX
% (2002/07 --ak)
%
\documentclass[12pt]{article}
\input glyphtounicode
\pdfgentounicode=1
\pdfminorversion5
\usepackage[pdftex]{graphicx}
\usepackage[a4paper]{geometry}
\usepackage{times}
%
\pdffontexpand\font 20 20 5 autoexpand
\pdfadjustspacing 2
%
\input{docinfo.out}
\usepackage[pdftex]{hyperref}
\hypersetup{colorlinks=true,bookmarksnumbered=true,%
pdftitle=\PDFTITLE,%
pdfsubject=\PDFSUBJECT,%
pdfauthor=\PDFAUTHOR,%
pdfkeywords=\PDFKEYWORDS}
\usepackage{ums}
\sloppy
\renewcommand{\baselinestretch}{1.36}
%
%
%
\begin{document}
%
%
%
%\pdfmapline{=msmin@Unicode@ <ipam.ttf}
%\pdfmapline{=msgoth@Unicode@ <ipag.ttf}
%
\input jpdftextounicode
%\pdfgentounicode=1
%
%
\begin{center}
\Huge\bfseries pdf\TeX{} for Win32 について
\end{center}
\vspace*{.5cm}
\begin{center}
\begin{minipage}[t]{0.5\textwidth}
\bfseries\LARGE この文書は、 pdf\LaTeX{} で日本語を扱う
サンプルとして書かれています。
\end{minipage}
\end{center}
\vspace*{.5cm}
%
%
\tableofcontents
\vspace*{.5cm}
%
%
\section{始めに}
\mbox{pdfTeX 1.40.10-2.2} (\mbox{Web2c-2009}, \mbox{web-2009},
\mbox{kpathsearch-5.0.0}) を \mbox{Win32(x86)}
用に \mbox{Microsoft} \mbox{VC++ 5.0} で Make したものです。
デフォルトで直接 PDF を出力するようにしていますが、
ソースで \verb|\pdfoutput=0|
とすれば、PDF でなくて DVI を出力します。PNG, JPEG,
EPDF (左下座標が原点の \mbox{/MediaBox} 文のある一ページだけの PDF 画像)
を埋め込むことがきます。TIFF 画像のサポートは打ちきられています。
bin ディレクトリにある \mbox{epstopdf.pl} は EPSF を EPDF
に変換する perl script です。\mbox{gswin32c.exe} に PATH が通っている
必要があります。また、 \mbox{epstopdf.exe}
は \mbox{epstopdf.pl} を、 perl を通して呼ぶための実行ファイルです。
なお，\LaTeXe{} の graphics package の pdftex オプションでは PNG(.png),
JPEG(.jpg), EPDF(.pdf), MetaPost 出力の EPSF(.mps)
の 4 種類の画像を埋め込むことができます。ただし以前の pdf\TeX{}
にくらべてプリミティブが大きく変化して改善されていますので、
graphics package は最新のものを使用して下さい。 \mbox{ltxpkgs.tar.gz}
をインストールした場合は、新しい pdf\TeX{} に対応した graphics package
がインストールされます。 また hyperref package も最新のものが必要です。
これも \mbox{ltxpkgs.tar.gz} を、 \TeX{} のインストールディレクトリ
(デフォルトは \mbox{c:/usr/local}) で展開すると、
1.40.10-2.2 対応のものがインストールされます。
%
\par\noindent
プリミティブが変更された例を一つあげます。初期の pdf\TeX{} では、
プリミティブレベルでは\\
\verb|\pdfimage width 12cm height 8cm depth 3pt {image.pdf}|\\
とすれば，イメージを挿入できましたが，1.40.10 では\\
\verb|\pdfximage width 12cm height 8cm depth 3pt {image.pdf}|\\
でまず図を定義します。まだこれでは実際に挿入されません。\\
\verb|\pdfrefximage\pdflastximage|\\
とすると挿入されます。定義した直後、カウンタ \verb|\pdflastximage|
に番号が入っていて、これをセーブしておけば、
同じ図を複数回コールできるようになります。 例えば\\
\verb|\newcount\figa \figa=\pdflastximage|\\
としておくと、任意の場所で\\
\verb|\pdfrefximage\figa|\\
によって、同じ図を view できるようになります。 しかし pdf\LaTeX{}
では、プリミティブを使うよりも、 graphics パッケージを使って
\begin{verbatim}
... ...
\usepackage[pdftex]{graphicx}
... ...
\begin{document}
... ...
\includegraphics[SomeOptions]{somefigure.png}
... ...
\end{document}
\end{verbatim}
などとするのが普通であり、お勧めです。 pdf\TeX{} パッケージに入っている、
サンプル JPEG 画像をここに含めてみます:
\begin{center}
\includegraphics{pic.jpg} 
\end{center}
%
\par\noindent
その他，\\
\verb|\pdfannotlink ---> \pdfstartlink|,\\
\verb|\pdfform ---> \pdfxform|,\\
\verb|\pdfrefform ---> \pdfrefxform|\\
などの変更があります。詳細は \mbox{texmf/doc/pdftex/base/syntax.txt}
をご覧下さい。
\par\noindent
\mbox{pdfTeX-1.40.10-2.2} では、 pdfcrypt 機能と
TIFF サポート機能が削除されています。
pdfcrypt に関しては、Paulo Soares さんによる、java によるプログラムを
入れ、これを簡単に使用するための \mbox{pdfcrypt.exe} を作成して入れています。
\mbox{texmf/pdfcrypt} にある文書を読んで下さい。
\par\noindent
%
%
e-TeX 拡張なしの pdfTeX は無くなりました。
W32TeX の文書では、pdfTeX と pdfeTeX を同じ意味で使うことにします。
基本実行ファイルは\mbox{pdftex.exe}と\mbox{pdflatex.exe}です。
\mbox{pdfetex.exe}, \mbox{pdfelatex.exe} も入れてありますが、それぞれ
\mbox{pdftex.exe}, \mbox{pdflatex.exe} と全くおなじものです。
\mbox{pdftex.exe} は \mbox{pdftex.fmt} を使い、
\mbox{pdflatex.exe} は \mbox{pdflatex.fmt} を使います。
全く同様に
\mbox{pdfetex.exe} は \mbox{pdftex.fmt} を使い、
\mbox{pdfelatex.exe} は \mbox{pdflatex.fmt} を使います。
\mbox{pdfetex.fmt}, \mbox{pdfelatex.fmt}は無いことに注意して下さい。
全ての場合に e-TeX の拡張プリミティブが使用できます。
e-TeX 2.2 の拡張プリミティブなどについては、e-TeX をインストールすると
コピーされる \mbox{texmf/doc/etex} 以下の文書を参照して下さい。
%
%
\section{\texorpdfstring{pdf\TeX{} での TrueType
フォント使用法}{pdfTeX での TrueType フォント使用法}}
pdf\TeX{} では Type 1 fonts に加えて，TrueType fonts
も使用することができます。以下にその方法を説明します。
\begin{enumerate}
\item \mbox{texmf.cnf} の \mbox{TTFONTS} に TrueType
       フォントの場所を設定しておきます:
\begin{verbatim}
TTFONTS = .;c:/windows/fonts;$TEXMF/fonts/truetype//
\end{verbatim}
\item 付属のドライバプログラム \mbox{ttftotfm.exe} を次のように使って 
      tfm と vf ファイルを作ります:
\begin{verbatim}
ttftotfm  arial.ttf  8r.enc  arial8t  arial8r
\end{verbatim}
   (ttftotfm の 使用法は後で説明します。)\\
   上のコマンドを実行する場合、 ttf フォントファイル や Encoding ファイル 
   は \mbox{Kpathsearch} 機構で探すようにしているので、
   カレントディレクトリにコピーしておく必要はありません。
   こうしてできた tfm ファイル (例では arial8t.tfm と arial8r.tfm)
   を \mbox{TEXMF} tree の適当な場所 
   (\mbox{texmf/fonts/tfm/windows/arial} など) に移動しておきます。
   また vf ファイル (今の例では arial8t.vf) を 
   \mbox{texmf/fonts/vf/windows/arial} に移動しておきます。\\
   \mbox{ttftotfm.exe} は次の三つのコマンドを内部から実行しているにすぎません:
\begin{verbatim}
ttf2afm -e 8r.enc -o arial8t.afm arial.ttf
afm2tfm arial8t.afm -t 8r.enc -p 8r.enc \
        -v arial8t.vpl arial8r.tfm
vptovf arial8t.vpl arial8t.vf arial8t.tfm
\end{verbatim}
\mbox{afm2tfm} の場合は、一行におさまらないので、二行に渡って
記述していますが、実際には一行のコマンド行です。
\item \mbox{texmf/fonts/map/pdftex/updmap/pdftex-base.map}
を編集して次のようなエントリを追加します:
\begin{verbatim}
arial8r ArialMT <8r.enc <arial.ttf	
\end{verbatim}
   この記述をするためのヒントは、 2. で tfm ファイルを作るときに
   表示されます。この変更を有効にするために \mbox{updmap} コマンドを
   実行します。
\end{enumerate}
\par\noindent
   以上で pdf\TeX{} ソースで (上の例では arial8t なる名前で)
   TrueType フォントが使用できるようになります。勿論日本語 TrueType
   フォントは使用不可です。
\begin{verbatim}
\font\exam=arial8t at 48pt
{\exam This is a test of TrueType fonts in pdf\TeX.}
\bye
\end{verbatim}   
   さて、上の 2. では必ず encoding file が必要ですが、
   適当な encoding file が無いときには
\begin{verbatim}
ttf2afm -c encname -e texnansi.enc ttfname.ttf >nul	
\end{verbatim}
   とすると \mbox{encname.eMN} (MN は数字) なる名前の encoding file
   が得られます。
   このディレクトリ(\mbox{texmf/doc/pdftex/base})
   に入れてある \mbox{wingding.enc} は
\begin{verbatim}
ttf2afm -c wingding -e texnansi.enc wingding.ttf >nul	
\end{verbatim}
   としてできた \mbox{wingding.e10} の名前を \mbox{wingding.enc}
   に変更し、
\begin{verbatim}
/WingdingsEncoding [	
\end{verbatim}
   という行だけ手で編集して作成したものです。
   ファイル \mbox{wingding.enc} を 
   \mbox{texmf/fonts/enc/pdftex/base}
   なるディレクトリに入れておけば
\begin{verbatim}
ttftotfm wingding.ttf wingding.enc wingding	
\end{verbatim}   
   とすると、 \mbox{wingding.tfm}, \mbox{rwingding.tfm},
   \mbox{wingding.vf} ができるので、
   これらを \mbox{texmf/fonts/tfm/windows/misc} と 
   \mbox{texmf/fonts/vf/windows/misc} に移動し、 
   \mbox{texmf/fonts/map/pdftex/updmap/pdftex-base.map} に
\begin{verbatim}
rwingding Wingdings-Regular <wingding.enc <wingding.ttf	
\end{verbatim}
   と記述してから \mbox{updmap} コマンドを
   実行することによって、 \mbox{wingding.ttf} を 
   pdf\TeX{} で使用できるようになります。どのコードが何に対応するか
   は \mbox{wingding.enc} から大体わかると
   思います。 (\verb|\char255| は Windows Logo です)。
   詳しくは \mbox{wingding.pdf} をご覧下さい。
\par\noindent
   最後に \mbox{ttftotfm} コマンドの使用法を記します。
\begin{verbatim}
(a) ttftotfm TTFfile.ttf ENCfile TeXfontname MapFontname
(b) ttftotfm TTFfile.ttf ENCfile TeXfontname
(c) ttftotfm TTFfile.ttf ENCfile
\end{verbatim}
   の三つの使用法があります。
   (a) が一番一般的な使用法です。
   \mbox{TTFfile.ttf} は TrueType font ファイル名です。 
   \mbox{ENCfile} は encoding ファイル名です。
   \mbox{TeXfontname} は \TeX{} で使用するときのフォント名です。
   \mbox{MapFontname} は \mbox{pdftex.map} に記述するときの
   フォント名です。\\
   (b) のように使用すると、 \mbox{MapFontname} は \mbox{TeXfontname}
   の先頭に r をくっつけたものとなります。\\
   (c) のように使用すると、 \mbox{TeXfontname} は \mbox{TTFfile.ttf}
   から拡張子をとり除いた \mbox{TTFfile} となり、 \mbox{MapFontname}
   は先頭に r をくっつけた \mbox{rTTFfile} となります。
   \mbox{ttf2afm} コマンドは，引数なしで実行すると使用法を表示します。
%
%
\section{xpdf 付属のアプリケーション}
   xpdf 付属の Derek~B.~Noonburg さんによるプログラムを 5 個
   入れておきます。ヘルプファイルはこのディレクトリにあります。
   なお、これらは xpdf 2.03 付属のユーティリティです。
\begin{enumerate}
\item pdftotext.exe\\
      PDF $\rightarrow$ Plain Text の変換をします。 
      \verb|pdftotext -help|
      で使用法を表示します。 第 \ref{xpdfjapan} 節
      で述べる準備をすれば、日本語にも対応するようになり、オプション
      \verb|-enc Shift-JIS| で \mbox{Shift-JIS}
      の日本語テキストを出力します。
\item pdftops.exe\\
       PDF $\rightarrow$ PS の変換をします。 \verb|pdftops -help|
       で使用法を表示します。
\item pdfinfo.exe\\
       PDF ファイルの情報を表示します。 \verb|pdfinfo -help|
       で使用法を表示します。
\item pdfimages.exe\\
       PDF に埋め込まれたイメージを抽出するためのものです。 
       \verb|pdfimages -help| で使用法を表示します。
\item pdffonts.exe\\
       PDF 内のフォント情報を表示します。
\end{enumerate}
%
%
\section{pdftotext を日本語対応に\label{xpdfjapan}}
   xpdf 付属ユーティリティを日本語対応にする方法を述べます。まず
   \mbox{Ghostscript} で CID フォントを扱っていたり、 
   \mbox{gs-7.07} をインストールして見た場合には、既に Resource
   ディレクトリがあると思います。 Resource ディレクトリが無い場合には
   新たに作れば良いです。 ここではこれが \mbox{D:/Resource}
   だとして説明します。違う場合には \mbox{D:/Resource}
   の部分を読みかえて下さい。\\
   まず最初に、 このディレクトリに \mbox{pdftotext-supp.zip}
   というファイルがあることを確認して下さい。
   これを Resource ディレクトリをカレントディレクトリとして展開します:
\begin{verbatim}
copy pdftotext-supp.zip D:\Resource
D:
cd \Resource
unzip -o pdftotext-supp.zip
del pdftotext-supp.zip
\end{verbatim}   
   次に、\TeX{} のバイナリディレクトリ (例えば \mbox{c:/usr/local/bin})
   にテキストファイル \mbox{xpdfrc} が入っているはずですから、 
   これを編集します。 Resource
   ディレクトリが実際に \mbox{D:/Resource} である場合には、編集
   しなくて良いようにしています。たとえば Resource ディレクトリが
   \mbox{C:/gs/Resource} である場合には、 xpdfrc で \mbox{D:/Resource}
   とある部分を
   \mbox{C:/gs/Resource} に変更して下さい。
\par\noindent
以上で、\mbox{pdftotext} が日本語対応となります。 
%
%
\section{日本語対応 pdf\LaTeX}
pdf\LaTeX{} または pdfe\LaTeX{} で日本語を扱う方法
を述べます。 Windows 上に限りますが、pdf\LaTeX{} と 
pdfe\LaTeX{} で日本語を含むソースを pdf に変換できるようにしてみました。
%
\subsection{条件}
\mbox{omegaj-w32.tar.gz} をインストールし、フォント 
\mbox{msmin??.tfm},  \mbox{msgoth??.tfm}
(?? は二桁の16進文字です) をインストール済みである
こと。 また、稲垣淳さんによる ums パッケージ 
\mbox{(ums.tar.gz)} をインストールしてあること。 
また、TrueType collection (.ttc) でない、適当な日本語 TrueType
フォントファイルがあること。(OS にインストールしてある必要は
ありません。) 入手可能な \mbox{ipam.ttf}, \mbox{ipag.ttf}
が適当でしょう。
以前は、\mbox{msmin??.pfb} などの Type1 フォントを準備しておく必要が
ありましたが、最新版として提供している pdf\TeX{}, pdfe\TeX{}
はサブフォント機構をサポートしているので、ソースのはじめのほうに、
例えば\\
\verb|\pdfmapline{=msmin@Unicode@ <ipam.ttf}|\\
\verb|\pdfmapline{=msgoth@Unicode@ <ipag.ttf}|\\
のように書いておくと、 TrueType フォントを直接埋め込むことが
できます。但しこの場合、出来上がった pdf から日本語文字を探したりすることは
できません。一方 \mbox{omegaj-w32.tar.gz} で提供しているバッチファイル
を実行して、\mbox{msmin??.pfb}, \mbox{msgoth??.pfb} を作成してある
場合には、ソースに\\
\verb|\input jpdftextounicode|\\
\verb|\pdfgentounicode=1|\\
と書いておくと、出来上がった pdf は本物の日本語 pdf となって、日本語
文字列の検索などもできます。
もちろんこの場合には、ソースに\\
\verb|\pdfmapline{=msmin@Unicode@ <ipam.ttf}|\\
\verb|\pdfmapline{=msgoth@Unicode@ <ipag.ttf}|\\
と書いたらいけません。
また、\mbox{msmin??.pfb}, \mbox{msgoth??.pfb} は、``現在の''
\mbox{omegaj-w32.tar.gz} で提供しているバッチファイルで
作成したものでなくてはいけません。以前提供していたバッチファイル
で作成したものや、 TeXTrace で作成したものは使用できませ
ん。 \mbox{jpdftextounicode.tex} はグリフ名と \mbox{Unicopde}
との対応表であり、グリフ名をこの表と一致させるためには、現在提供
しているバッチファイルで \mbox{Type1} フォントを作成する必要があるのです。
%
\subsection{実現法}
編集した、オリジナルの日本語を含む \LaTeX{} 文書 (e.g., \mbox{org.tex})
を、プログラム \mbox{topdftex.exe} によって、 
pdf\LaTeX{}, pdfe\LaTeX{} が理解できる
もの (e.g., \mbox{pdfsrc.tex}) に変換します。 \mbox{org.tex} では必ず
\verb|\usepackage{ums}|
をプリアンブルに記述しておきます。 \mbox{topdftex.exe}
は \mbox{pdftex-w32.tar.gz} に同梱しています。 
\mbox{ums.sty} は、稲垣淳さんに
よるものを少し拡張して、日本語 pdf\LaTeX{} でも使用できるよう
にしたものです。
\begin{verbatim}
topdftex org.tex pdfsrc.tex
pdflatex pdfsrc
\end{verbatim}
により、 \mbox{pdfsrc.pdf} が作成されます。
例えば、\\
\verb|\documentclass[12pt]{article}|\\
\verb|\usepackage{ums}|\\
\verb|\begin{document}|\\
\verb|\pdfmapline{=msmin@Unicode@ <ipam.ttf}|\\
\verb|\pdfmapline{=msgoth@Unicode@ <ipag.ttf}|\\
これは、\\
\verb|pdf\TeX|\\
で日本語を\\
扱ってみた\\
ものです。\\
\verb|\end{document}|\\
を \mbox{topdftex.exe} で変換すると
\begin{verbatim}
\documentclass[12pt]{article}
\usepackage{ums}
\begin{document}
\pdfmapline{=msmin@Unicode@ <ipam.ttf}
\pdfmapline{=msgoth@Unicode@ <ipag.ttf}
\UMS{3053}\UMS{308C}\UMS{306F}\PREUMS{3001}%
pdf\TeX
\UMS{3067}\UMS{65E5}\UMS{672C}\UMS{8A9E}\UMS{3092}%
\UMS{6271}\UMS{3063}\UMS{3066}\UMS{307F}\UMS{305F}%
\UMS{3082}\UMS{306E}\UMS{3067}\UMS{3059}\PREUMS{3002}%
\end{document}
\end{verbatim}
のように、日本語文字は全てコマンドで置き換えられます。これらの
コマンドは \mbox{ums.sty} で定義されています。
%
\subsection{日本語しおり作成法}
\mbox{hyperref} で \mbox{bookmarks}
を付ける場合にも最新の \mbox{ums} パッケージと、最新の 
\mbox{out2uni.exe} を使うと極めて簡単に日本語しおりを作成する
ことができます。 \mbox{topdftex.exe} で変換済みの \mbox{pdfsrc.tex} を、
クロスリファレンスの解決が終了するまで
必要回数 pdf\LaTeX{} にかけます。
次に一回だけ
\begin{verbatim}
out2uni  pdfsrc
\end{verbatim}
とします。\mbox{out2uni.exe} は \mbox{dvipdfm-w32.tar.gz} に入っています。
これにより、pdf 文字列が Unicode に変換
されます。そうして最後にやはり一回だけ \verb|pdflatex pdfsrc|
とすると、日本語しおりを含む pdf が出力されます。
このディレクトリに入っている \mbox{jpdfsample.pdf} はこのようにして作成
した、日本語しおり付きの簡単な pdf です。\mbox{jpdforg.tex}
がオリジナルのソースで、 \mbox{jpdfsample.tex} は
\begin{verbatim}
topdftex jpdforg.tex jpdfsample.tex	
\end{verbatim}
によって変換されたソースです。なお、使用するクラスファイルや、
パッケージは、欧文用のものを使うことに注意して下さい。 
p\LaTeX{} や j\LaTeX{} 特有のものは使用できません。
\mbox{topdftex} での変換作業が必要なので、面倒なようですが、
Makefile などを使用すると、訂正を頻繁にする場合でもそれほど面倒
ではありません。例えば、この文書自身は
\begin{verbatim}
#
# Makefile for jpdfsample.pdf
# (uses Korn shell sh.exe)
#
all: jpdfsample.pdf
jpdfsample.pdf: jpdfsample.tex
        pdflatex jpdfsample
        (while egrep '^LaTeX Warning: Label' jpdfsample.log; \
         do pdflatex jpdfsample; done)
        out2uni jpdfsample
        pdflatex jpdfsample
jpdfsample.tex: jpdforg.tex
        topdftex jpdforg.tex jpdfsample.tex
test: jpdfsample.pdf
        pdfview jpdfsample
clean:
        rm -f jpdfsample.* *~
\end{verbatim}
のような Makefile を作っておくと、 \mbox{jpdforg.tex} を
訂正し終わったとき、 
\verb|make| とするだけで、全ての作業は自動的になされます。 
\verb|make| が成功した場合、仕上がり具合を見るには 
\verb|make test| とします。 \mbox{pdfview} というのは 
\verb|Acrobat Reader| を立ち上げるものと仮定します。
なお、上の Makefile は、 \mbox{texmf/doc/ksh} に入れている \mbox{sh.exe}
に加えて、\mbox{cp.exe}, \mbox{rm.exe}, \mbox{egrep.exe}
の存在を仮定して書いてあります。 \mbox{sh.exe} は、 
Windows NT/2000/XP で使用することができます。 
Windows 9x ではうまく機能しないでしょう。
シェルとして、cmd.exe や command.com を使う通常の Windows
上の、標準的な Makefile は、下のようにしておけばよいです:
\begin{verbatim}
#
# Makefile for jpdfsample.pdf
# (standard Windows) (cmd.exe or command.com)
#
all: jpdfsample.pdf
jpdfsample.pdf: jpdfsample.tex
        pdflatex jpdfsample
        pdflatex jpdfsample
        out2uni jpdfsample
        pdflatex jpdfsample
jpdfsample.tex: jpdforg.tex
        topdftex jpdforg.tex jpdfsample.tex
test: jpdfsample.pdf
        pdfview jpdfsample
clean:
        del jpdfsample.*
        del *~
\end{verbatim}
\begin{verbatim}
A. Kakuto <kakuto@fuk.kindai.ac.jp>
\end{verbatim}
\end{document}
